<div class="container">
  <div class="page-header">
    <h1 class="page-title">Explore Dances</h1>
    <p class="page-subtitle">Discover, favorite, and track your dance journey</p>
  </div>

  <div class="filters">
    <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()" class="search-input" placeholder="Search dances..." />
    <div class="style-filters">
      <button class="btn" [class.btn--primary]="selectedStyleId() === null" [class.btn--ghost]="selectedStyleId() !== null" (click)="filterByStyle(null)">All</button>
      @for (style of styles(); track style.id) {
        <button class="btn" [class.btn--primary]="selectedStyleId() === style.id" [class.btn--ghost]="selectedStyleId() !== style.id" (click)="filterByStyle(style.id)">
          {{ style.name }}
        </button>
      }
    </div>
  </div>

  @if (loading()) {
    <div class="loading">Loading dances...</div>
  } @else if (dances().length === 0) {
    <div class="empty">No dances found.</div>
  } @else {
    <div class="grid grid--2">
      @for (dance of dances(); track dance.id) {
        <div class="card dance-card">
          <div class="dance-card__header">
            <h3 class="dance-card__name">{{ dance.name }}</h3>
            @if (auth.isAuthenticated()) {
              <div class="dance-card__actions">
                <button class="icon-btn" [class.active]="dance.isFavorite" (click)="toggleFavorite(dance, $event)" title="Favorite">
                  {{ dance.isFavorite ? '&#9733;' : '&#9734;' }}
                </button>
                <button class="icon-btn" [class.active]="dance.isLearned" (click)="toggleLearned(dance, $event)" title="Mark as learned">
                  {{ dance.isLearned ? '&#10003;' : '&#9675;' }}
                </button>
              </div>
            }
          </div>
          @if (dance.description) {
            <p class="dance-card__desc">{{ dance.description }}</p>
          }
          <div class="dance-card__meta">
            <div class="dance-card__styles">
              @for (style of dance.styles; track style) {
                <span class="badge">{{ style }}</span>
              }
              @for (ms of dance.musicalStyles; track ms) {
                <span class="badge badge--music">â™ª {{ ms }}</span>
              }
            </div>
            <span class="video-count">{{ dance.videoCount }} video{{ dance.videoCount !== 1 ? 's' : '' }}</span>
          </div>
          <a [routerLink]="['/dances', dance.id]" class="btn btn--ghost btn--sm">View details</a>
        </div>
      }
    </div>
  }
</div>
